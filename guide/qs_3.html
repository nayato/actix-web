<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Application - Actix web</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Actix web framework guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="./qs_1.html">Quickstart</a></li><li><a href="./qs_2.html"><strong>1.</strong> Getting Started</a></li><li><a href="./qs_3.html" class="active"><strong>2.</strong> Application</a></li><li><a href="./qs_3_5.html"><strong>3.</strong> Server</a></li><li><a href="./qs_4.html"><strong>4.</strong> Handler</a></li><li><a href="./qs_4_5.html"><strong>5.</strong> Errors</a></li><li><a href="./qs_5.html"><strong>6.</strong> URL Dispatch</a></li><li><a href="./qs_7.html"><strong>7.</strong> Request &amp; Response</a></li><li><a href="./qs_8.html"><strong>8.</strong> Testing</a></li><li><a href="./qs_10.html"><strong>9.</strong> Middlewares</a></li><li><a href="./qs_12.html"><strong>10.</strong> Static file handling</a></li><li><a href="./qs_9.html"><strong>11.</strong> WebSockets</a></li><li><a href="./qs_13.html"><strong>12.</strong> HTTP/2</a></li><li><a href="./qs_14.html"><strong>13.</strong> Database integration</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Actix web</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./qs_3.html#application" id="application"><h1>Application</h1></a>
<p>Actix web provides some primitives to build web servers and applications with Rust.
It provides routing, middlewares, pre-processing of requests, and post-processing of responses,
websocket protcol handling, multipart streams, etc.</p>
<p>All actix web server is built around <code>Application</code> instance.
It is used for registering routes for resources, middlewares.
Also it stores application specific state that is shared across all handlers
within same application.</p>
<p>Application acts as namespace for all routes, i.e all routes for specific application
has same url path prefix. Application prefix always contains laading &quot;/&quot; slash.
If supplied prefix does not contain leading slash, it get inserted.
Prefix should consists of valud path segments. i.e for application with prefix <code>/app</code>
any request with following paths <code>/app</code>, <code>/app/</code> or <code>/app/test</code> would match,
but path <code>/application</code> would not match.</p>
<pre><code class="language-rust ignore"># extern crate actix_web;
# extern crate tokio_core;
# use actix_web::*;
# fn index(req: HttpRequest) -&gt; &amp;'static str {
#    &quot;Hello world!&quot;
# }
# fn main() {
   let app = Application::new()
       .prefix(&quot;/app&quot;)
       .resource(&quot;/index.html&quot;, |r| r.method(Method::GET).f(index))
       .finish()
# }
</code></pre>
<p>In this example application with <code>/app</code> prefix and <code>index.html</code> resource
get created. This resource is available as on <code>/app/index.html</code> url.
For more information check
<a href="./qs_5.html#using-a-application-prefix-to-compose-applications"><em>URL Matching</em></a> section.</p>
<p>Multiple applications could be served with one server:</p>
<pre><pre class="playpen"><code class="language-rust"># extern crate actix_web;
# extern crate tokio_core;
# use tokio_core::net::TcpStream;
# use std::net::SocketAddr;
use actix_web::*;

fn main() {
    HttpServer::&lt;TcpStream, SocketAddr, _, _&gt;::new(|| vec![
        Application::new()
            .prefix(&quot;/app1&quot;)
            .resource(&quot;/&quot;, |r| r.f(|r| httpcodes::HTTPOk)),
        Application::new()
            .prefix(&quot;/app2&quot;)
            .resource(&quot;/&quot;, |r| r.f(|r| httpcodes::HTTPOk)),
        Application::new()
            .resource(&quot;/&quot;, |r| r.f(|r| httpcodes::HTTPOk)),
    ]);
}
</code></pre></pre>
<p>All <code>/app1</code> requests route to first application, <code>/app2</code> to second and then all other to third.
Applications get matched based on registration order, if application with more general
prefix is registered before less generic, that would effectively block less generic
application to get matched. For example if <em>application</em> with prefix &quot;/&quot; get registered
as first application, it would match all incoming requests.</p>
<a class="header" href="./qs_3.html#state" id="state"><h2>State</h2></a>
<p>Application state is shared with all routes and resources within same application.
State could be accessed with <code>HttpRequest::state()</code> method as a read-only item
but interior mutability pattern with <code>RefCell</code> could be used to archive state mutability.
State could be accessed with <code>HttpContext::state()</code> in case of http actor.
State also available to route matching predicates and middlewares.</p>
<p>Let's write simple application that uses shared state. We are going to store requests count
in the state:</p>
<pre><pre class="playpen"><code class="language-rust"># extern crate actix;
# extern crate actix_web;
#
use actix_web::*;
use std::cell::Cell;

// This struct represents state
struct AppState {
    counter: Cell&lt;usize&gt;,
}

fn index(req: HttpRequest&lt;AppState&gt;) -&gt; String {
    let count = req.state().counter.get() + 1; // &lt;- get count
    req.state().counter.set(count);            // &lt;- store new count in state

    format!(&quot;Request number: {}&quot;, count)       // &lt;- response with count
}

fn main() {
    Application::with_state(AppState{counter: Cell::new(0)})
        .resource(&quot;/&quot;, |r| r.method(Method::GET).f(index))
        .finish();
}
</code></pre></pre>
<p>Note on application state, http server accepts application factory rather than application
instance. Http server construct application instance for each thread, so application state
must be constructed multiple times. If you want to share state between different thread
shared object should be used, like <code>Arc</code>. Application state does not need to be <code>Send</code> and <code>Sync</code>
but application factory must be <code>Send</code> + <code>Sync</code>.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./qs_2.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./qs_3_5.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./qs_2.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./qs_3_5.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        
        <!-- Google Analytics Tag -->
        <script>
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is 
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-110322332-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
